<template>
  <div>
    <div class="ui attached segment typo content blog" v-if="blog" :style="bgColor">
      <!--文章是否加密-->
      <div class="m-padded-tb-large placeholder"
           v-if="!result.secrecy || result.password === password">
        <transition-group enter-active-class="animate__animated animate__fadeIn">
          <div :key="1">
            <div class="ui large red right corner label" v-if="blog.top">
              <i class="arrow alternate circle up icon"></i>
            </div>
            <div class="ui middle aligned mobile reversed">
              <div class="ui grid m-margin-lr">
                <!--标题-->
                <div class="row m-padded-tb-small">
                  <h2 class="ui header m-center" :style="bgColor">{{ blog.title }}</h2>
                </div>
                <!--文章简要信息-->
                <div class="row m-padded-tb-small">
                  <div class="ui horizontal link list m-center">
                    <div class="item m-datetime">
                      <i class="small calendar icon"></i><span>{{ blog.createTime | formatDateTime }}</span>
                    </div>
                    <div class="item m-views">
                      <i class="small eye icon"></i><span>{{ blog.views }}</span>
                    </div>

                    <a class="item m-common-black" @click.prevent=" $store.state.setting.focusMode = !$store.state.setting.focusMode
                    " >
                      <div class="item m-common-black"  :data-inverted="['inverted']" data-tooltip="纯净模式" data-position="top center">
                        <i class="laptop icon" :style="bgColor"></i>
                      </div>
                    </a>

                    <a class="item m-common-black" @click.prevent="bigFontSize = !bigFontSize">
                      <div data-inverted="inverted"  data-tooltip="点击切换字体大小" data-position="top center">
                        <i class="font icon" :style="bgColor"></i>
                      </div>
                    </a>
                  </div>
                </div>
                <!--分类-->


                <router-link :to="`/category/${blog.category.name}`" :class=" `ui label  ${blog.category.color?blog.category.color:'teal'} ribbon `"
                             style="color: white;text-decoration: none;">
                  {{ blog.category.name }}
                </router-link>

                <!--文章Markdown正文-->
                <div class="
                  typo
                  m-padded-tb-small
                  line-numbers
                  match-braces
                  rainbow-braces
                  blog-js-toc-content
                " :class="{ 'm-big-fontsize': bigFontSize }" v-html="blog.content" v-viewer></div>

                <!--赞赏-->
                <div class="ui center aligned container m-padded-tb-small" v-if="blog.appreciation">
                  <Appreciate :alipay="chatUrl.alipay" :wechatPayment="chatUrl.wetchatPayment" />
                </div>

                <el-divider />
                <div class="row m-padded-tb-no">
                  <div class="column m-padding-left-no">
                    <router-link :to="`/tag/${tag.name}`" class="ui tag label m-text-500 m-margin-small"
                                 :class="tag.color?tag.color:'teal'" v-for="(tag, index) in blog.tags" :key="index">
                      {{ tag.name }}
                    </router-link>
                  </div>
                </div>

                <el-divider />
              </div>
            </div>

            <div class="ui positive message" :style="bgColor">
              <div class="ui grid">
                <div class="thirteen wide computer sixteen wide mobile column">
                  <div class="float left">
                    <ul class="list">
                      <li>作者: {{ blog.username }}</li>
                      <li>发表时间 : {{ blog.createTime }}</li>
                      <li v-if="blog.updateTime">
                        最后修改：{{ blog.updateTime }}
                      </li>
                      <li>
                        本站点采用<a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">
                        署名 4.0 国际 (CC BY 4.0) </a>创作共享协议。可自由转载、引用，并且允许商业性使用。但需署名作者且注明文章出处。
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="three wide computer sixteen wide mobile column ">
                  <div class="ui center aligned" style="text-align: center">
                    <BlogCode :text="blogUrl" />
                  </div>
                </div>
              </div>
            </div>

            <el-divider />

            <div class="ui grid m-pre-next-blog-container">
              <div class="eight wide column">
                <div class="ui left floated basic button teal animated" @click="beforeBlog">
                  <div class="visible content">上一篇</div>
                  <div class="hidden content">
                    <i class="left arrow icon"></i>
                  </div>
                </div>
              </div>
              <div class="eight wide column">
                <div class="ui right floated basic button teal animated" @click="nextBlog">
                  <div class="visible content">下一篇</div>
                  <div class="hidden content">
                    <i class="right arrow icon"></i>
                  </div>
                </div>
              </div>
            </div>
            <el-divider />

            <!--博客信息-->

            <div class="ui attached bottom">
              <BlogComment :blogId="blogId" :commentEnabled="blog.commentEnabled" v-if="blog.commentEnabled" />
              <h3 v-else>
                评论已关闭
<!--                <svg t="1638578477994" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"-->
<!--                     p-id="4194" width="32" height="32">-->
<!--                  <path-->
<!--                      d="M314.133333 99.946667C436.266667 40.533333 585.493333 38.613333 707.84 98.24c-6.293333 9.706667-12.266667 19.626667-18.56 29.333333-18.666667-28.16-54.933333-30.826667-84.693333-38.933333-70.613333-12.373333-147.733333-17.28-214.826667 12.48-21.653333 9.386667-43.733333 18.026667-66.24 25.173333l-9.386667-26.346666z"-->
<!--                      fill="#EEA44E" p-id="4195"></path>-->
<!--                  <path-->
<!--                      d="M244.906667 119.253333c-44.266667-41.813333 64.32-72.213333 69.226666-19.306666l9.386667 26.346666c22.506667-7.146667 44.586667-15.786667 66.24-25.173333 36.16 11.84 65.813333 74.88 26.773333 97.6-25.28-7.573333-21.226667-38.293333-29.866666-57.813333-28.053333 10.346667-58.986667 32.96-88.746667 14.72-2.773333-4.8-8.426667-14.4-11.306667-19.2-0.96-4.266667-2.986667-12.906667-4.053333-17.173334-0.64-3.093333-2.026667-9.386667-2.773333-12.586666-11.626667 4.16-23.253333 8.32-34.88 12.586666z"-->
<!--                      fill="#A2390A" p-id="4196"></path>-->
<!--                  <path-->
<!--                      d="M707.84 98.24c13.12-19.626667 40.853333-27.2 61.333333-14.4 14.4 7.786667 42.773333 21.333333 30.506667 41.813333-17.813333 14.933333-36.906667-8.96-53.866667-14.933333-1.28 1.813333-3.733333 5.44-5.013333 7.253333-2.986667 4.16-8.853333 12.693333-11.733333 16.853334-10.88 14.186667-21.013333 29.866667-36.586667 39.36-18.666667 5.333333-35.413333-6.293333-52.053333-12.693334-11.946667 10.453333-26.666667 41.173333-43.413334 20.16-18.24-15.893333 6.72-35.2 17.066667-47.573333 17.066667-19.84 42.88-5.12 63.04-0.32l12.16-6.186667c6.293333-9.706667 12.266667-19.626667 18.56-29.333333z"-->
<!--                      fill="#A43C0D" p-id="4197"></path>-->
<!--                  <path-->
<!--                      d="M389.76 101.12c67.093333-29.76 144.213333-24.853333 214.826667-12.48 29.76 8.106667 66.026667 10.773333 84.693333 38.933333l-12.16 6.186667c-20.16-4.8-45.973333-19.52-63.04 0.32-10.346667 12.373333-35.306667 31.68-17.066667 47.573333 16.746667 21.013333 31.466667-9.706667 43.413334-20.16 16.64 6.4 33.386667 18.026667 52.053333 12.693334 15.573333-9.493333 25.706667-25.173333 36.586667-39.36 82.773333 51.413333 151.68 126.826667 187.2 218.346666 39.466667 97.813333 40 209.706667 3.52 308.586667-21.866667-30.08-66.56-30.186667-83.2 4.906667-5.12-18.026667-10.666667-35.84-16.64-53.546667-4.053333-88.64-13.973333-177.706667-46.186667-261.12 4.373333-2.773333 13.12-8.32 17.386667-11.093333-38.186667-32.853333-92.906667-34.346667-138.026667-54.186667-22.08-4.48-53.44-29.973333-66.56 2.24 22.506667 10.56 46.186667 18.24 69.866667 25.813333-15.573333 22.933333-7.466667 50.56-4.8 75.733334 10.026667 69.973333 8.853333 141.226667-0.213334 211.2-32-39.04-74.88-77.12-128.426666-76.906667-61.226667-3.413333-112.64 38.826667-146.24 86.08-7.893333-57.493333-13.653333-115.413333-10.88-173.44 1.28-41.706667 12.266667-83.52 2.666666-125.013333 20.266667-11.2 67.413333-7.893333 51.52-42.026667-60.48 19.093333-120 41.386667-181.226666 58.24 4.8-23.146667 26.346667-38.293333 28.906666-62.08 6.613333-37.76 14.506667-75.626667 30.186667-110.933333 29.76 18.24 60.693333-4.373333 88.746667-14.72 8.64 19.52 4.586667 50.24 29.866666 57.813333 39.04-22.72 9.386667-85.76-26.773333-97.6z"-->
<!--                      fill="#FEE377" p-id="4198"></path>-->
<!--                  <path-->
<!--                      d="M740.8 117.973333c115.84 59.84 196.16 177.92 221.653333 304.533334 21.226667 119.786667 1.066667 252.16-75.093333 349.653333-7.68 9.92-15.466667 19.733333-23.146667 29.76-5.226667 5.973333-15.573333 18.133333-20.8 24.213333-3.093333-4.16-9.493333-12.693333-12.586666-16.96 34.666667-45.866667 69.76-92.586667 88.96-147.413333 36.48-98.88 35.946667-210.773333-3.52-308.586667-35.52-91.52-104.426667-166.933333-187.2-218.346666 2.88-4.16 8.746667-12.693333 11.733333-16.853334z"-->
<!--                      fill="#EFA950" p-id="4199"></path>-->
<!--                  <path-->
<!--                      d="M56.853333 479.04c9.6-146.773333 95.146667-289.6 225.706667-359.786667 1.066667 4.266667 3.093333 12.906667 4.053333 17.173334-56 46.933333-114.453333 94.08-149.653333 159.786666-94.72 161.28-69.866667 385.173333 65.493333 516.373334-5.44 6.613333-10.986667 13.12-16.746666 19.413333-90.666667-92.16-139.306667-223.893333-128.853334-352.96z"-->
<!--                      fill="#EEA950" p-id="4200"></path>-->
<!--                  <path-->
<!--                      d="M136.96 296.213333c35.2-65.706667 93.653333-112.853333 149.653333-159.786666 2.88 4.8 8.533333 14.4 11.306667 19.2-15.68 35.306667-23.573333 73.173333-30.186667 110.933333-2.56 23.786667-24.106667 38.933333-28.906666 62.08-1.813333 3.413333-5.653333 10.453333-7.573334 13.866667 3.52 3.093333 10.453333 9.173333 13.973334 12.16-8.64 38.613333-22.08 76.16-27.413334 115.52-16.32 113.386667-3.093333 228.693333-15.36 342.4-135.36-131.2-160.213333-355.093333-65.493333-516.373334z"-->
<!--                      fill="#FFCA73" p-id="4201"></path>-->
<!--                  <path-->
<!--                      d="M238.826667 328.64c61.226667-16.853333 120.746667-39.146667 181.226666-58.24 15.893333 34.133333-31.253333 30.826667-51.52 42.026667l-19.626666 6.4c-24.853333 7.68-49.706667 15.253333-73.92 24.533333-9.92 3.733333-19.84 7.573333-29.76 11.306667-3.52-2.986667-10.453333-9.066667-13.973334-12.16 1.92-3.413333 5.76-10.453333 7.573334-13.866667zM586.56 288.96c13.12-32.213333 44.48-6.72 66.56-2.24 45.12 19.84 99.84 21.333333 138.026667 54.186667-4.266667 2.773333-13.013333 8.32-17.386667 11.093333-5.653333-1.706667-17.173333-5.013333-22.933333-6.72-26.56-8.426667-52.693333-18.346667-79.466667-26.346667-3.733333-1.066667-11.2-3.093333-14.933333-4.16-23.68-7.573333-47.36-15.253333-69.866667-25.813333z"-->
<!--                      p-id="4202"></path>-->
<!--                  <path-->
<!--                      d="M348.906667 318.826667l19.626666-6.4c9.6 41.493333-1.386667 83.306667-2.666666 125.013333-2.773333 58.026667 2.986667 115.946667 10.88 173.44 6.4 40.106667 15.253333 79.893333 28.266666 118.4 13.866667 50.24 39.573333 96 56.533334 145.066667 0 33.92-39.786667 47.573333-68.16 44.586666-35.626667-22.293333-78.08-25.706667-118.613334-18.453333-25.92 5.013333-48.746667-6.506667-70.08-19.2-23.573333 3.413333-62.4-1.386667-49.92-35.306667l1.386667 5.546667c1.386667 5.76 4.373333 17.28 5.76 23.04 18.453333-0.64 36.8-1.386667 55.253333-2.026667a692.8 692.8 0 0 1-41.92-11.306666c0.106667-4.586667 0.426667-13.76 0.533334-18.346667 28.8 6.293333 40.96-20.906667 49.813333-42.346667 56.106667-13.546667 114.24-4.8 171.2-9.92-3.946667-33.706667-11.52-66.88-22.506667-98.88-2.986667-10.24-5.866667-20.586667-8.746666-30.826666-3.733333-17.92-7.68-35.733333-10.986667-53.653334-9.386667-78.08-10.24-157.013333-4.16-235.413333 1.493333-17.706667-0.32-35.413333-1.493333-53.013333zM864.213333 801.92c7.68-10.026667 15.466667-19.84 23.146667-29.76 12.906667 7.36 39.893333 19.093333 26.666667 38.4-11.52 24.32-42.346667 12.373333-49.813334-8.64m22.506667-11.626667c-5.333333 14.293333-0.213333 19.733333 15.146667 16.533334 5.44-14.293333 0.426667-19.733333-15.146667-16.533334zM102.4 797.546667c16.426667-4.373333 32.32 9.386667 38.72 23.573333 5.653333 26.026667-32.533333 51.306667-51.413333 28.16-20.16-15.04-9.173333-45.226667 12.693333-51.733333m-9.386667 23.253333c4.16 12.586667 29.76 13.546667 34.346667 0.96-1.813333-17.706667-31.786667-18.773333-34.346667-0.96zM852.586667 845.973333l13.12-10.88c4.16 4.586667 12.586667 13.653333 16.746666 18.24-2.986667 5.973333-8.746667 17.92-11.733333 24l-5.866667-0.746666c-18.666667-2.56-37.44-5.013333-56.106666-7.253334 17.6-3.733333 35.2-7.573333 52.906666-11.413333-2.24-2.986667-6.826667-8.96-9.066666-11.946667z"-->
<!--                      fill="#3EB3E4" p-id="4203"></path>-->
<!--                  <path-->
<!--                      d="M274.986667 343.36c24.213333-9.28 49.066667-16.853333 73.92-24.533333 1.173333 17.6 2.986667 35.306667 1.493333 53.013333-3.733333 30.293333-8.533333 60.48-10.24 91.093333-5.866667-25.6-11.306667-51.306667-15.466667-77.226666-14.506667 0.426667-29.226667-0.533333-43.52 2.24-10.346667 12.053333-13.44 35.413333-33.92 32.64 6.613333-26.56 14.4-53.12 27.733334-77.226667zM886.72 790.293333c15.573333-3.2 20.586667 2.24 15.146667 16.533334-15.36 3.2-20.48-2.24-15.146667-16.533334zM93.013333 820.8c2.56-17.813333 32.533333-16.746667 34.346667 0.96-4.586667 12.586667-30.186667 11.626667-34.346667-0.96z"-->
<!--                      fill="#E6EFF3" p-id="4204"></path>-->
<!--                  <path-->
<!--                      d="M651.626667 390.506667c-2.666667-25.173333-10.773333-52.8 4.8-75.733334 3.733333 1.066667 11.2 3.093333 14.933333 4.16-11.093333 31.573333 0 64.213333 3.093333 96 2.133333 91.52 2.773333 184.213333-19.306666 273.6-2.88 11.84-5.973333 23.573333-8.746667 35.306667-6.506667 23.04-13.653333 45.866667-21.973333 68.266667-12.266667 30.826667-24.32 61.76-34.666667 93.333333 41.173333 20.693333 83.52-4.266667 124.906667-10.026667 28.053333 6.933333 55.04 17.706667 83.52 23.466667-14.186667 0.32-28.373333 0.96-42.453334 0.32-50.026667-11.84-94.506667 14.613333-141.866666 24.64-17.493333-10.88-45.76-23.253333-40-49.28 14.186667-44.266667 36.16-85.76 47.893333-130.986667 1.706667-5.546667 4.906667-16.746667 6.613333-22.293333 10.453333-39.253333 17.493333-79.36 23.04-119.573333 9.066667-69.973333 10.24-141.226667 0.213334-211.2z"-->
<!--                      fill="#24A1D8" opacity=".98" p-id="4205"></path>-->
<!--                  <path-->
<!--                      d="M674.453333 414.933333c-3.093333-31.786667-14.186667-64.426667-3.093333-96 26.773333 8 52.906667 17.92 79.466667 26.346667 13.013333 42.773333 27.306667 85.226667 34.666666 129.493333-21.333333-2.88-21.013333-31.146667-38.826666-38.933333-15.786667-3.306667-31.786667 1.066667-47.68 1.813333-5.226667 19.2-10.88 38.186667-16.106667 57.386667-1.6-26.88-4.8-53.546667-8.426667-80.106667z"-->
<!--                      fill="#DDEAF0" p-id="4206"></path>-->
<!--                  <path-->
<!--                      d="M245.226667 354.666667c9.92-3.733333 19.84-7.573333 29.76-11.306667-13.333333 24.106667-21.12 50.666667-27.733334 77.226667-2.88 12.266667-5.44 24.64-7.573333 37.12-2.453333 13.546667-4.586667 27.093333-6.293333 40.746666-13.12 100.16-4.906667 201.386667-7.786667 302.08-8.853333 21.44-21.013333 48.64-49.813333 42.346667l9.92-10.88c5.76-6.293333 11.306667-12.8 16.746666-19.413333 12.266667-113.706667-0.96-229.013333 15.36-342.4 5.333333-39.36 18.773333-76.906667 27.413334-115.52z"-->
<!--                      fill="#23A7E2" p-id="4207"></path>-->
<!--                  <path-->
<!--                      d="M750.826667 345.28c5.76 1.706667 17.28 5.013333 22.933333 6.72 32.213333 83.413333 42.133333 172.48 46.186667 261.12 0.746667 65.386667 0.32 131.413333 10.88 196.053333 3.093333 4.266667 9.493333 12.8 12.586666 16.96 7.253333 3.413333 14.72 6.506667 22.293334 8.96l-13.12 10.88c-13.12-7.68-32-11.413333-37.013334-27.946666-5.546667-35.626667-6.506667-71.893333-14.293333-107.306667-0.426667-7.253333-1.28-21.866667-1.6-29.226667-0.426667-43.093333 0.96-86.4-5.866667-129.066666-2.026667-26.026667-4.373333-51.946667-8.32-77.653334-7.36-44.266667-21.653333-86.72-34.666666-129.493333z"-->
<!--                      fill="#3DB0DA" p-id="4208"></path>-->
<!--                  <path-->
<!--                      d="M340.16 462.933333c1.706667-30.613333 6.506667-60.8 10.24-91.093333-6.08 78.4-5.226667 157.333333 4.16 235.413333-1.173333 5.226667-3.52 15.573333-4.693333 20.693334-15.466667-46.293333-70.72-25.386667-107.306667-29.866667 3.733333-19.626667 5.973333-39.573333 8-59.52 27.2-3.2 54.613333-5.653333 81.92-5.013333l4.693333 23.04c4.8-31.04 6.506667-62.506667 2.986667-93.653334z"-->
<!--                      fill="#9DD4EB" p-id="4209"></path>-->
<!--                  <path-->
<!--                      d="M281.173333 387.946667c14.293333-2.773333 29.013333-1.813333 43.52-2.24 4.16 25.92 9.6 51.626667 15.466667 77.226666 3.52 31.146667 1.813333 62.613333-2.986667 93.653334l-4.693333-23.04c-2.24-20.8-3.413333-41.706667-4.693333-62.72-19.52-0.96-39.68-6.08-58.88-0.64-8.32 9.173333-15.466667 19.2-23.04 29.013333-2.133333-13.866667-4.266667-27.733333-6.186667-41.493333 2.133333-12.48 4.693333-24.853333 7.573333-37.12 20.48 2.773333 23.573333-20.586667 33.92-32.64z"-->
<!--                      fill="#CBE4EF" p-id="4210"></path>-->
<!--                  <path-->
<!--                      d="M674.453333 414.933333c3.626667 26.56 6.826667 53.226667 8.426667 80.106667-2.56 25.28-2.453333 50.666667-0.64 76.053333l0.853333 21.44c29.653333-4.693333 59.84-6.506667 89.813334-3.84 3.306667 7.36 10.026667 22.08 13.333333 29.44 1.813333-16.32 3.733333-32.64 5.546667-48.96l2.026666-16.746666c6.826667 42.666667 5.44 85.973333 5.866667 129.066666-45.973333-23.253333-102.613333-26.24-144.533333 7.04 22.08-89.386667 21.44-182.08 19.306666-273.6z"-->
<!--                      fill="#8ACDEA" p-id="4211"></path>-->
<!--                  <path-->
<!--                      d="M698.986667 437.653333c15.893333-0.746667 31.893333-5.12 47.68-1.813333 17.813333 7.786667 17.493333 36.053333 38.826666 38.933333 3.946667 25.706667 6.293333 51.626667 8.32 77.653334l-2.026666 16.746666c-7.68-18.346667-15.04-37.226667-26.56-53.546666-21.013333-6.72-43.306667-2.773333-64.853334-1.813334-6.08 19.093333-12.48 37.973333-18.133333 57.28-1.813333-25.386667-1.92-50.773333 0.64-76.053333 5.226667-19.2 10.88-38.186667 16.106667-57.386667z"-->
<!--                      fill="#BCDFEE" p-id="4212"></path>-->
<!--                  <path-->
<!--                      d="M233.386667 498.453333c1.706667-13.653333 3.84-27.2 6.293333-40.746666 1.92 13.76 4.053333 27.626667 6.186667 41.493333 7.573333-9.813333 14.72-19.84 23.04-29.013333 19.2-5.44 39.36-0.32 58.88 0.64 1.28 21.013333 2.453333 41.92 4.693333 62.72-27.306667-0.64-54.72 1.813333-81.92 5.013333-2.026667 19.946667-4.266667 39.893333-8 59.52-2.666667 6.186667-7.786667 18.56-10.346667 24.746667 0.213333-41.493333-0.853333-82.88 1.173334-124.373334z"-->
<!--                      fill="#B2DBED" p-id="4213"></path>-->
<!--                  <path-->
<!--                      d="M225.6 800.533333c2.88-100.693333-5.333333-201.92 7.786667-302.08-2.026667 41.493333-0.96 82.88-1.173334 124.373334-1.92 27.84-2.026667 55.786667-0.213333 83.626666 0.853333 11.84 1.813333 23.573333 2.88 35.413334 40.213333-27.413333 90.88-11.733333 136.213333-16.64 0.853333-8.426667 2.453333-25.173333 3.2-33.493334 10.986667 32 18.56 65.173333 22.506667 98.88-56.96 5.12-115.093333-3.626667-171.2 9.92zM624.426667 792.106667c8.32-22.4 15.466667-45.226667 21.973333-68.266667l4.693333 18.346667 23.04-14.72c42.88 5.12 95.36-8.853333 125.866667 30.186666-0.533333 12.373333-1.066667 24.853333-1.706667 37.226667-57.706667-6.826667-115.84-1.813333-173.866666-2.773333z"-->
<!--                      fill="#5CBDE6" p-id="4214"></path>-->
<!--                  <path-->
<!--                      d="M700.373333 513.813333c21.546667-0.96 43.84-4.906667 64.853334 1.813334 11.52 16.32 18.88 35.2 26.56 53.546666-1.813333 16.32-3.733333 32.64-5.546667 48.96-3.306667-7.36-10.026667-22.08-13.333333-29.44-29.973333-2.666667-60.16-0.853333-89.813334 3.84l-0.853333-21.44c5.653333-19.306667 12.053333-38.186667 18.133333-57.28z"-->
<!--                      fill="#A3D6EC" p-id="4215"></path>-->
<!--                  <path-->
<!--                      d="M376.746667 610.88c33.6-47.253333 85.013333-89.493333 146.24-86.08 53.546667-0.213333 96.426667 37.866667 128.426666 76.906667-5.546667 40.213333-12.586667 80.32-23.04 119.573333-19.413333-18.24-38.506667-38.72-64.64-46.933333-51.306667-19.626667-113.28 0.213333-145.28 44.373333 1.493333 4.693333 4.373333 13.973333 5.76 18.56l-19.2-8c-13.013333-38.506667-21.866667-78.293333-28.266666-118.4z"-->
<!--                      fill="#7D180F" p-id="4216"></path>-->
<!--                  <path-->
<!--                      d="M242.56 598.08c36.586667 4.48 91.84-16.426667 107.306667 29.866667 1.173333-5.12 3.52-15.466667 4.693333-20.693334 3.306667 17.92 7.253333 35.733333 10.986667 53.653334-0.853333 3.946667-2.346667 11.946667-3.2 16-42.133333-27.626667-110.72-23.466667-130.346667 29.546666-1.813333-27.84-1.706667-55.786667 0.213333-83.626666 2.56-6.186667 7.68-18.56 10.346667-24.746667z"-->
<!--                      fill="#87CCEA" p-id="4217"></path>-->
<!--                  <path-->
<!--                      d="M819.946667 613.12c5.973333 17.706667 11.52 35.52 16.64 53.546667 16.64-35.093333 61.333333-34.986667 83.2-4.906667-19.2 54.826667-54.293333 101.546667-88.96 147.413333-10.56-64.64-10.133333-130.666667-10.88-196.053333z"-->
<!--                      fill="#FFD675" p-id="4218"></path>-->
<!--                  <path-->
<!--                      d="M232 706.453333c19.626667-53.013333 88.213333-57.173333 130.346667-29.546666 0.853333-4.053333 2.346667-12.053333 3.2-16 2.88 10.24 5.76 20.586667 8.746666 30.826666-0.746667 8.32-2.346667 25.066667-3.2 33.493334-45.333333 4.906667-96-10.773333-136.213333 16.64-1.066667-11.84-2.026667-23.573333-2.88-35.413334z"-->
<!--                      fill="#72C5E8" p-id="4219"></path>-->
<!--                  <path-->
<!--                      d="M418.453333 718.72c32-44.16 93.973333-64 145.28-44.373333 26.133333 8.213333 45.226667 28.693333 64.64 46.933333-1.706667 5.546667-4.906667 16.746667-6.613333 22.293333-12.586667-7.573333-24.426667-16.746667-37.973333-22.72-49.386667-4.906667-99.626667-3.52-147.84 8.106667l-17.493334-10.24z"-->
<!--                      fill="#F47461" p-id="4220"></path>-->
<!--                  <path-->
<!--                      d="M655.146667 688.533333c41.92-33.28 98.56-30.293333 144.533333-7.04 0.32 7.36 1.173333 21.973333 1.6 29.226667-0.32 15.68-0.746667 31.36-1.28 46.933333-30.506667-39.04-82.986667-25.066667-125.866667-30.186666l-23.04 14.72-4.693333-18.346667c2.773333-11.733333 5.866667-23.466667 8.746667-35.306667z"-->
<!--                      fill="#71C5E8" p-id="4221"></path>-->
<!--                  <path-->
<!--                      d="M435.946667 728.96c48.213333-11.626667 98.453333-13.013333 147.84-8.106667 13.546667 5.973333 25.386667 15.146667 37.973333 22.72-11.733333 45.226667-33.706667 86.72-47.893333 130.986667-5.76 26.026667 22.506667 38.4 40 49.28-25.706667 20.8-60.053333 20.053333-91.413334 21.226667-44.16 0.426667-91.306667-0.213333-129.066666-26.133334 28.373333 2.986667 68.16-10.666667 68.16-44.586666-16.96-49.066667-42.666667-94.826667-56.533334-145.066667l19.2 8c-1.386667-4.586667-4.266667-13.866667-5.76-18.56l17.493334 10.24z"-->
<!--                      fill="#FFCD73" p-id="4222"></path>-->
<!--                  <path-->
<!--                      d="M801.28 710.72c7.786667 35.413333 8.746667 71.68 14.293333 107.306667 5.013333 16.533333 23.893333 20.266667 37.013334 27.946666 2.24 2.986667 6.826667 8.96 9.066666 11.946667-17.706667 3.84-35.306667 7.68-52.906666 11.413333 18.666667 2.24 37.44 4.693333 56.106666 7.253334-13.44 1.28-26.88 1.813333-40.32 2.133333-6.613333 5.013333-19.733333 15.146667-26.346666 20.16-28.48-5.76-55.466667-16.533333-83.52-23.466667-41.386667 5.76-83.733333 30.72-124.906667 10.026667 10.346667-31.573333 22.4-62.506667 34.666667-93.333333 58.026667 0.96 116.16-4.053333 173.866666 2.773333 0.64-12.373333 1.173333-24.853333 1.706667-37.226667 0.533333-15.573333 0.96-31.253333 1.28-46.933333z"-->
<!--                      fill="#43B4E4" p-id="4223"></path>-->
<!--                  <path-->
<!--                      d="M156.16 851.52l16.64-19.2 2.986667 10.56c-0.106667 4.586667-0.426667 13.76-0.533334 18.346667 13.866667 4.16 27.733333 8 41.92 11.306666-18.453333 0.64-36.8 1.386667-55.253333 2.026667-1.386667-5.76-4.373333-17.28-5.76-23.04z"-->
<!--                      fill="#31CEFF" p-id="4224"></path>-->
<!--                  <path-->
<!--                      d="M896.64 866.24c-0.426667-27.306667 45.653333 2.24 31.146667 19.306667-11.52 22.933333-49.066667 9.706667-44.48-16.64l9.6 7.04c3.306667 21.013333 37.866667 13.76 22.613333-5.866667l-18.88-3.84z"-->
<!--                      fill="#105470" opacity=".51" p-id="4225"></path>-->
<!--                  <path-->
<!--                      d="M896.64 866.24l18.88 3.84c15.253333 19.626667-19.306667 26.88-22.613333 5.866667l3.733333-9.706667z"-->
<!--                      fill="#7CD7F3" p-id="4226"></path>-->
<!--                  <path-->
<!--                      d="M274.773333 900.48c40.533333-7.253333 82.986667-3.84 118.613334 18.453333 37.76 25.92 84.906667 26.56 129.066666 26.133334 31.36-1.173333 65.706667-0.426667 91.413334-21.226667 47.36-10.026667 91.84-36.48 141.866666-24.64-141.44 92.586667-339.626667 95.04-480.96 1.28z"-->
<!--                      fill="#EFAA50" p-id="4227"></path>-->
<!--                </svg>-->
              </h3>
            </div>
          </div>
        </transition-group>
      </div>

      <div class="ui center aligned container blog_password m-padded-lr-big" v-else>
        <div class="ui m-padded-tb-mini">
          <el-tooltip content="点击输入密码解锁" placement="bottom" effect="light">
            <div class="ui inverted button" tabindex="0" @click="getData($route.params.blogId)">
              <div class="content">
                <svg t="1638715240373" class="icon" viewBox="0 0 1024 1024" version="1.1"
                     xmlns="http://www.w3.org/2000/svg" p-id="2330" width="150" height="150">
                  <path
                      d="M153.6 469.312v469.376h716.8V469.312H153.6zM64 384h896v640H64V384z m403.2 329.92c-26.752-14.72-44.8-42.304-44.8-73.92 0-47.104 40.128-85.312 89.6-85.312 49.472 0 89.6 38.208 89.6 85.312 0 31.616-18.048 59.136-44.8 73.92v115.968a44.8 44.8 0 0 1-89.6 0v-115.968zM332.8 384h358.4V256c0-94.272-80.256-170.688-179.2-170.688-98.944 0-179.2 76.416-179.2 170.688v128zM512 0c148.48 0 268.8 114.56 268.8 256v128H243.2V256c0-141.44 120.32-256 268.8-256z"
                      fill="#262626" p-id="2331"></path>
                </svg>
              </div>
            </div>
          </el-tooltip>
        </div>

        <div class="ui grid m-padded-tb-mini">
          <div class="eight wide column">
            <div class="ui left floated basic button teal animated" @click="getBeforeBlog">
              <div class="visible content">上一篇</div>
              <div class="hidden content">
                <i class="left arrow icon"></i>
              </div>
            </div>
          </div>

          <div class="eight wide column">
            <div class="ui right floated basic button teal animated" @click="getNextBlog">
              <div class="visible content">下一篇</div>
              <div class="hidden content">
                <i class="right arrow icon"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <sui-segment class="blog" v-else>
      <sui-dimmer active inverted>
        <sui-loader content="Loading..." />
      </sui-dimmer>

      <docs-wireframe name="short-paragraph" />
    </sui-segment>
  </div>



</template>

<script>
import dateFormat from "@/utils/date.js";
import {colors} from "@/utils/setting";
import BlogComment from "@/components/blog/BlogComment";
import {
  setBlogPassword,
  getBlogPassword
} from "@/network/auth.js";
import {
  mapActions
} from "vuex";
import BlogCode from "@/components/blog/BlogCode.vue";
import Appreciate from "@/components/blog/Appreciate.vue";

export default {
  name: "Blog",
  components: {
    BlogComment,
    BlogCode,
    Appreciate,
  },
  data() {
    return {
      blog: {},
      blogId: "",
      content: "",
      bigFontSize: "16px",
      password: "",
      blogUrl: "",
      userId: "",
      result: {
        secrecy: false,
        password: "",
      },
      chatUrl: {},
      blogkey: "wuxin_blog_key",
    };
  },
  filters: {
    formatDateTime(value) {
      let date = new Date(value);
      return dateFormat.formatDate(date, "yyyy-MM-dd hh:mm");
    },
  },
  computed: {
    blogPasswordKey() {
      return this.blogkey + this.$route.params.blogId;
    },
  },

  methods: {
    ...mapActions("blog", [
      "setBlogId",
      "getDetailBlog",
      "getChatUrl",
      "beforeBlog",
      "nextBlog",
    ]),

    getData(blogId) {
      this.setBlogId(blogId);
      this.getDetailBlog(blogId)
          .then((res) => {
            this.setPass(res);
            //加密了，同时判断密码是否输入
            if (res.result.secrecy) {
              this.password = getBlogPassword(this.blogPasswordKey);
              if (res.result.password !== this.password) {
                // 请输入密码
                this.open(res);
              } else {
                // 加载数据
                this.loadData(res);
              }
            } else {
              // 没有设置密码直接加载数据
              this.loadData(res);
            }
          })
          .catch(() => {
          });
    },
    backTop() {
      window.scrollTo(0, 0);
    },

    loadData(res) {
      this.blog = res.result;
      this.userId = res.result.userId;
      // 回到顶部
      this.backTop();
      this.$nextTick(() => {
        // 获取地址栏完整地址 设置本文二维码
        this.blogUrl = window.location.href;
        // 加载高亮插件
        this.$primsjs.highlightAll();
        // 加载目录
        this.loadingContents(true)
        // 是否开启了赞赏功能
        if (res.result.appreciation) {
          this.getChat(this.userId);
        }
      });
    },

    setPass(res) {
      this.result.secrecy = res.result.secrecy;
      this.result.password = res.result.password;
    },

    loadingContents(loading) {
      this.$store.state.blog.loadingComplete = loading;
      console.log('文章目录加载状态 :>> ', this.$store.state.blog.loadingComplete);
    },

    // 添加密码
    open(res) {
      this.$prompt("该篇文章设置了密码,需输入密码才能查看哦", "提示", {
        confirmButtonText: "确定",
      })
          .then(({
                   value
                 }) => {
            this.password = value;
            if (res.result.password !== this.password) {
              this.open(res);
              this.$message.error(" 密码输入错误! 请重新输入!");
            } else {
              setBlogPassword(this.blogPasswordKey, value);
              this.loadData(res);
            }
          })
          .catch(() => {
            this.$message({
              type: "info",
              message: "操作取消",
            });
          });
    },

    getChat(userId) {
      this.getChatUrl(userId).then((res) => {
        this.chatUrl = res.result;
      });
    },

    getBeforeBlog() {
      this.beforeBlog(this.blogId).then((res) => {
        if (res.code === 200) {
          this.$router.push(`/blog/${res.result.blogId}`);
        } else {
          this.$message.error("没有更多了！");
        }
      });
    },

    getNextBlog() {
      this.nextBlog(this.blogId).then((res) => {
        if (res.code === 200) {
          this.$router.push(`/blog/${res.result.blogId}`);
        } else {
          this.$message.error("没有更多了！");
        }
      });
    },
  },

  beforeRouteEnter(to, _, next) {
    next((vm) => {
      vm.blogId = to.params.blogId;
      vm.getData(vm.blogId);
      vm.$store.state.blog.loadingComplete = false
    });
  },

  beforeRouteUpdate(to, from, next) {
    if (to.path !== from.path) {
      this.blogId = to.params.blogId;
      this.loadingContents(true)
      // this.$tocbot.refresh();
      this.getData(this.blogId);
      next();
    }
  },

  // beforeRouteLeave(to, _, next) {
  //   // 离开销毁目录组件加载状态
  //   this.$tocbot.destroy()
  //   this.loadingContents(false);
  //   next();
  // },
};
</script>

<style scoped>
.blog_password {
  padding-top: 10% !important;
}

.blog {
  min-height: 100vh !important;
}


a {
  text-decoration: none !important;
  color: #ffffff;
}

</style>
